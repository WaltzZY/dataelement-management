# 自动化测试数据生成系统 - 使用指南

## 📖 系统简介

这是一个基于真实数据的智能化API接口测试系统,能够自动扫描项目中的所有REST API接口,基于数据库现有数据生成测试用例,并自动执行测试并记录结果。

### 核心功能

1. **自动API扫描** - 扫描所有`@RestController`标注的接口
2. **智能数据生成** - 从数据库采样真实数据生成测试用例
3. **自动接口调用** - 批量执行测试用例并记录结果
4. **可视化界面** - Vue.js前端,友好的操作界面
5. **JSON存储** - 所有数据存储在JSON文件中,便于查看和管理

## 🏗️ 系统架构

```
自动化测试系统
├── 后端模块 (Spring Boot)
│   ├── ApiScanner - API接口扫描器
│   ├── TestDataGenerator - 测试数据生成器
│   ├── ApiExecutor - 接口执行器
│   ├── JsonStorageManager - JSON存储管理器
│   └── AutoTestController - REST API控制器
│
├── 前端模块 (Vue.js 3)
│   └── index.html - 单页面应用
│
└── 数据存储 (JSON文件)
    ├── autotest-data/testcases/ - 测试用例
    └── autotest-data/results/ - 执行结果
```

## 🚀 快速开始

### 1. 启动应用

确保Spring Boot应用已启动:

```bash
cd dataelement-management
mvn clean package
cd dataelement-management-console
mvn spring-boot:run
```

应用启动后,监听端口: `http://localhost:10216`

### 2. 访问前端界面

打开浏览器访问:

```
http://localhost:10216/baseDataelementManage/autotest/index.html
```

### 3. 基本操作流程

#### 步骤1: 扫描API接口
- 点击"扫描接口"按钮
- 系统会自动扫描所有Controller中的API接口
- 显示接口列表,包括路径、HTTP方法、Controller类名等

#### 步骤2: 生成测试用例
- 方式1: 单个生成 - 点击某个API的"生成用例"按钮
- 方式2: 批量生成 - 点击"批量生成用例"按钮生成所有API的测试用例

系统会:
- 从数据库中采样真实数据
- 生成多样化的测试用例(基础查询、边界值、组合条件等)
- 保存到JSON文件

#### 步骤3: 执行测试
- 方式1: 单个执行 - 点击某个API的"执行测试"按钮
- 方式2: 批量执行 - 在"执行结果"标签页点击"执行所有测试"按钮

系统会:
- 调用实际的REST API接口
- 记录响应状态码、响应时间、响应内容
- 保存执行结果到JSON文件

#### 步骤4: 查看结果
- 切换到"执行结果"标签页
- 查看所有测试执行记录
- 点击"查看详情"可以看到完整的请求参数和响应内容

## 📊 功能详解

### API接口管理

**功能:**
- 显示所有扫描到的API接口
- 显示每个API是否已生成测试用例
- 提供单个或批量操作

**表格列:**
- API路径 - 接口的完整URL路径
- HTTP方法 - GET/POST/PUT/DELETE
- Controller - 控制器类名
- 方法名 - 具体的Java方法名
- 测试用例 - 已生成的用例数量
- 操作 - 生成用例/执行测试/查看用例

### 测试用例管理

**功能:**
- 查看所有已生成的测试用例
- 按API分组展示
- 显示每个用例的详细信息

**用例信息:**
- 用例描述 - 测试场景说明
- 请求参数 - JSON格式的完整参数
- 数据来源 - 数据生成方式(数据库采样/自动生成)
- 状态 - 是否启用

### 执行结果查看

**功能:**
- 查看所有测试执行历史
- 统计成功率和响应时间
- 查看详细的执行结果

**结果信息:**
- API路径和HTTP方法
- 执行时间
- HTTP状态码
- 响应时间(毫秒)
- 成功/失败状态
- 详细的请求参数和响应内容

### 统计面板

显示关键指标:
- **API接口总数** - 已扫描的接口数量
- **测试用例总数** - 已生成的测试用例数量
- **执行次数** - 总的测试执行次数
- **成功率** - 测试用例通过率(%)

## 🎯 测试用例生成策略

系统针对不同类型的API采用不同的数据生成策略:

### DataElementPageQueryDto (分页查询)

生成10种测试用例:

1. **基础分页查询** - pageNum=1, pageSize=10
2. **大页码查询** - pageNum=100, pageSize=10
3. **大分页大小** - pageNum=1, pageSize=100
4. **关键词搜索** - 从数据库中随机选择关键词
5. **按状态筛选** - 使用数据库中真实的状态值
6. **按数源单位筛选** - 使用数据库中真实的单位代码
7. **组合条件查询** - 组合多个筛选条件
8. **排序测试(升序)** - sortField=collectunitqty, sortOrder=asc
9. **排序测试(降序)** - sortField=collectunitqty, sortOrder=desc
10. **状态排序** - sortField=status, sortOrder=asc

### ManualConfirmUnitDto (手动定源)

生成2种测试用例:

1. **正常手动定源** - 使用数据库中真实的dataid和sourceUnitId
2. **不存在的数据元ID** - 使用随机生成的不存在的ID,用于异常测试

### 通用API

生成2种基础测试用例:

1. **空参数请求** - 不传递任何参数
2. **基础参数请求** - 传递通用的id和name参数

## 📁 数据存储结构

所有数据以JSON格式存储在`autotest-data/`目录:

### 测试用例存储

**位置:** `autotest-data/testcases/`

**命名:** `testcase_{api_path}.json`

**格式:**
```json
{
  "apiPath": "/business/allDataElement/getAllDataElementPage",
  "httpMethod": "POST",
  "controllerClass": "AlldataelementinfoController",
  "methodName": "getAllDataElementPage",
  "testCases": [
    {
      "id": "uuid",
      "description": "基础分页查询",
      "requestParams": {
        "pageNum": 1,
        "pageSize": 10
      },
      "dataSource": "自动生成",
      "createTime": "2025-11-03T10:00:00",
      "enabled": true
    }
  ],
  "totalCount": 10
}
```

### 执行结果存储

**位置:** `autotest-data/results/`

**命名:** `results_yyyyMMdd.json` (按日期存储)

**格式:**
```json
[
  {
    "id": "uuid",
    "testCaseId": "test-case-uuid",
    "apiPath": "/business/allDataElement/getAllDataElementPage",
    "httpMethod": "POST",
    "executeTime": "2025-11-03T10:05:00",
    "requestParams": {...},
    "responseStatus": 200,
    "responseBody": {...},
    "responseTime": 150,
    "success": true,
    "errorMessage": null
  }
]
```

## 🔧 REST API接口

系统提供以下REST API供前端或其他系统调用:

| 接口 | 方法 | 说明 |
|------|------|------|
| `/autotest/apis` | GET | 扫描所有API接口 |
| `/autotest/testcases/generate` | POST | 为指定API生成测试用例 |
| `/autotest/testcases/generate-all` | POST | 批量生成所有API的测试用例 |
| `/autotest/testcases` | GET | 获取指定API的测试用例 |
| `/autotest/testcases/all` | GET | 获取所有测试用例 |
| `/autotest/execute` | POST | 执行指定API的测试用例 |
| `/autotest/execute-all` | POST | 执行所有测试用例 |
| `/autotest/results` | GET | 获取测试执行结果 |
| `/autotest/statistics` | GET | 获取统计信息 |
| `/autotest/testcases` | DELETE | 删除指定API的测试用例 |
| `/autotest/health` | GET | 健康检查 |

## 💡 使用建议

### 最佳实践

1. **定期扫描** - 代码更新后重新扫描API接口
2. **批量生成** - 一次性为所有接口生成测试用例
3. **持续执行** - 定期执行测试用例,监控接口健康状态
4. **结果分析** - 重点关注失败的测试用例,及时修复问题

### 注意事项

1. **数据依赖** - 测试用例基于数据库现有数据生成,确保数据库有足够的测试数据
2. **接口影响** - 执行测试会实际调用接口,对于修改数据的接口要谨慎使用
3. **性能考虑** - 批量执行测试时会产生大量请求,注意系统负载
4. **网络连接** - 前端使用CDN资源,需要网络连接

## 🔍 故障排查

### 前端无法访问

**问题:** 浏览器打开页面显示404

**解决:**
1. 确认Spring Boot应用已启动
2. 确认访问URL正确: `http://localhost:10216/baseDataelementManage/autotest/index.html`
3. 检查`static/autotest/index.html`文件是否存在

### 接口调用失败

**问题:** 点击"扫描接口"后提示失败

**解决:**
1. 打开浏览器开发者工具(F12)查看Network标签
2. 检查请求URL和响应内容
3. 确认后端`AutoTestController`已正确启动
4. 检查CORS配置是否正确

### 测试用例生成失败

**问题:** 生成测试用例时提示失败

**解决:**
1. 检查数据库连接是否正常
2. 确认数据库中有足够的测试数据
3. 查看后端日志,找到具体错误信息
4. 检查`autotest-data`目录是否有写入权限

### 测试执行失败

**问题:** 执行测试用例时大量失败

**解决:**
1. 检查API服务是否正常运行
2. 确认`ApiExecutor`中的`BASE_URL`配置正确
3. 查看具体的错误信息和堆栈跟踪
4. 手动调用API接口验证是否可以正常访问

## 📝 扩展开发

### 添加新的数据生成策略

在`TestDataGenerator.java`中添加新的生成方法:

```java
private List<TestCase> generateCustomTestCases(ApiInfo apiInfo) {
    // 自定义测试用例生成逻辑
    List<TestCase> testCases = new ArrayList<>();

    // 从数据库读取数据
    // 生成测试用例

    return testCases;
}
```

### 自定义测试用例模板

修改`TestDataGenerator.generateTestCases()`方法,根据不同的参数类型调用不同的生成方法。

### 添加新的统计维度

在`JsonStorageManager.java`中的`getExecutionStatistics()`方法添加新的统计逻辑。

## 📞 技术支持

如有问题,请检查:

1. **后端日志** - 查看Spring Boot控制台输出
2. **浏览器控制台** - 查看前端JavaScript错误
3. **JSON文件** - 检查`autotest-data/`目录下的数据文件
4. **网络请求** - 使用浏览器开发者工具查看API请求和响应

## 🎉 系统特点

✅ **零配置** - 无需额外配置,开箱即用
✅ **智能化** - 自动从数据库采样真实数据
✅ **可视化** - 友好的Web界面
✅ **灵活性** - JSON存储,易于查看和修改
✅ **扩展性** - 模块化设计,易于扩展新功能

---

**版本:** 1.0.0
**更新日期:** 2025-11-03
**作者:** AutoTest System

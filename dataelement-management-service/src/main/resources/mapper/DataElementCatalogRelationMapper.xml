<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.inspur.dsp.direct.dao.DataElementCatalogRelationMapper">
    <resultMap id="BaseResultMap" type="com.inspur.dsp.direct.dbentity.DataElementCatalogRelation">
        <!--@mbg.generated-->
        <!--@Table data_element_catalog_relation-->
        <id column="dataid" jdbcType="VARCHAR" property="dataid"/>
        <result column="data_element_id" jdbcType="VARCHAR" property="dataElementId"/>
        <result column="catalog_id" jdbcType="VARCHAR" property="catalogId"/>
        <result column="catalog_name" jdbcType="VARCHAR" property="catalogName"/>
        <result column="info_item_id" jdbcType="VARCHAR" property="infoItemId"/>
        <result column="info_item_name" jdbcType="VARCHAR" property="infoItemName"/>
        <result column="catalog_unit_code" jdbcType="VARCHAR" property="catalogUnitCode"/>
        <result column="catalog_unit_name" jdbcType="VARCHAR" property="catalogUnitName"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--@mbg.generated-->
        dataid, data_element_id, catalog_id, `catalog_name`, info_item_id,
        info_item_name, info_item_datatype, catalog_unit_code, catalog_unit_name
    </sql>

    <select id="getAssociatedDataSourceCatalog" resultMap="BaseResultMap">
        SELECT *
        FROM data_element_catalog_relation
        WHERE
            data_element_id = #{baseDataId}
        <if test="sourceUnitCode != null and sourceUnitCode != ''">
            AND catalog_unit_code = #{sourceUnitCode}
        </if>
    </select>

    <select id="getAssociatedCollectorCatalog" resultMap="BaseResultMap">
        SELECT *
        FROM data_element_catalog_relation
        WHERE
          data_element_id = #{baseDataId}
        <if test="sourceUnitCode != null and sourceUnitCode != ''">
            AND catalog_unit_code != #{sourceUnitCode}
        </if>
    </select>

    <delete id="cancelCatalogAssociation">
        DELETE
        FROM data_element_catalog_relation
        WHERE dataid = #{dataid}
    </delete>

    <select id="findRelationExist" resultMap="BaseResultMap">
        SELECT *
        FROM data_element_catalog_relation
        WHERE data_element_id = #{dataElementId}
          AND info_item_id = #{infoItemId}
    </select>

    <delete id="deleteCatalogAssociation">
        DELETE
        FROM data_element_catalog_relation
        WHERE dataid = #{dataid}
    </delete>

    <!-- 查询数据元的关联目录列表(定标模块专用) -->
    <select id="selectAssociatedCatalogs" resultMap="BaseResultMap">
        SELECT *
        FROM data_element_catalog_relation
        WHERE data_element_id = #{dataElementId}
        <if test="sourceOrgCode != null and sourceOrgCode != ''">
            AND catalog_unit_code = #{sourceOrgCode}
        </if>
        ORDER BY create_date DESC
    </select>

    <!-- 检查目录关联关系是否存在(定标模块专用) -->
    <select id="selectRelationByDataElementAndItem" resultMap="BaseResultMap">
        SELECT *
        FROM data_element_catalog_relation
        WHERE data_element_id = #{dataElementId}
          AND info_item_id = #{catalogitemid}
        LIMIT 1
    </select>

</mapper>